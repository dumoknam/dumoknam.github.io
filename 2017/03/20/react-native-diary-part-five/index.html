<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>React Native 일기장 앱 개발 (End) - 글쓰기 기능 · Anything</title><meta name="description" content="React Native 일기장 앱 개발 (End) - 글쓰기 기능 - Dumok Nam"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/gandalfr.css"><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/solarized-light.css"><link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Anything"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="https://avatars2.githubusercontent.com/u/2771223?v=3&amp;s=460" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/dumoknam" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">React Native 일기장 앱 개발 (End) - 글쓰기 기능 <a href="https://github.com/dumoknam/hexo_posts/edit/master/react-native-diary-part-five.md"><i class="fa fa-pencil-square"></i></a></h1><div class="tags"><a href="/tags/React-Native/" class="tag-title">#React Native</a><a href="/tags/App/" class="tag-title">#App</a></div><div class="post-info">Mar 20, 2017</div><div class="post-content"><p>일기 쓰기 화면과 저장 기능을 만들자</p>
<a id="more"></a>
<p><strong>이미지를 클라우드를 쓰다가 직접 올리는 방법으로 바꿨는데 블로그 옮기다가 날려먹었다.. 일기장 포스팅 스크린샷은 없다</strong></p>
<p><em>한달간 많은 일이 있었다. 조금 정리가 되어 공부 재개!</em></p>
<hr>
<h1 id="기존-코드-정리"><a href="#기존-코드-정리" class="headerlink" title="기존 코드 정리"></a>기존 코드 정리</h1><p>글쓰기 창 구현 전에 기존 컴포넌트들을 정리하는 작업부터 진행해보자.</p>
<h2 id="DiaryListView"><a href="#DiaryListView" class="headerlink" title="DiaryListView"></a>DiaryListView</h2><p>리스트 뷰의 일기목록은 하드코딩으로 항상 1월 데이터만 나오게 되어 있었다.<br>현재 월의 일기가 나오도록 realm 데이터를 읽는 부분을 바꿔보자.<br><code>ListView</code>의 <code>DataSource</code>를 설정하기 위해 호출하는 <code>realm</code>의 <code>getDiaryByYearMonth</code>의 파라미터를 변경하여야 한다. 아래와 같이 현재 날짜의 연도, 월을 전달하도록 하자.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> diaryData = diaryRealm.getDiaryByYearMonth(<span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear(),<span class="keyword">new</span> <span class="built_in">Date</span>().getMonth());</div></pre></td></tr></table></figure></p>
<h2 id="DiaryTitleView"><a href="#DiaryTitleView" class="headerlink" title="DiaryTitleView"></a>DiaryTitleView</h2><p><code>ListView</code>의 <code>Title</code>을 표시하는 부분도 변경이 필요하다.<br><code>headerText</code>가 현재 연-월 이 되도록 변경하자.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> headerText = [<span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear(),<span class="keyword">new</span> <span class="built_in">Date</span>().getMonth()+<span class="number">1</span>].join(<span class="string">' - '</span>);</div></pre></td></tr></table></figure></p>
<h2 id="TempDiaryContents"><a href="#TempDiaryContents" class="headerlink" title="TempDiaryContents"></a>TempDiaryContents</h2><p>임시 일기 데이터는 더이상 필요 없다. <code>TempDiaryContents.js</code> 파일을 삭제하자.</p>
<hr>
<h1 id="Modal"><a href="#Modal" class="headerlink" title="Modal"></a>Modal</h1><p>첫 포스트에서 만들었던 글쓰기 <code>+</code> 버튼을 누를때<br>새로운 창이 뜨도록 할 것이다.<br>이런 기능을 구현하기 적당한 것이 <a href="https://facebook.github.io/react-native/docs/modal.html" target="_blank" rel="external">Modal View</a>이다.</p>
<p>구현 방법은 이렇다.<br>Modal 은 화면 표시 여부를 <code>modalVisible</code> 이란 이름의 <code>prop</code>으로 관리한다. 이 값을 글쓰기 <code>+</code>버튼을 누를때 <code>true</code>로 전달하여 나타나게 하고, 글쓰기 취소를 누르면 <code>false</code>로 변경되게 하여 화면에서 사라지게 할 것이다.</p>
<p>우선 <code>src\components\WriteModalView.js</code> 파일을 생성하자.</p>
<h2 id="WriteButton"><a href="#WriteButton" class="headerlink" title="WriteButton"></a>WriteButton</h2><p>글쓰기 버튼의 구현 내용은 아래와 같이 변경되었다.<br><script src="//gist.github.com/5dbabe7ad3b30c3bbd431d3bc3321120.js?file=WriteButton.js"></script></p>
<p><code>WriteButton</code>의 자식으로 <code>WritemodalView</code>를 두었고, 자식의 <code>prop</code>을 <code>WriteButton</code>이 <code>state</code>로 관리하게 된다.</p>
<ul>
<li><code>WriteButton</code>의 <code>state</code>인 <code>modalVisible</code>변수 –&gt; <code>WriteModalView</code>의 <code>prop</code>인 <code>modalVisible</code>변수</li>
<li><code>WriteButton</code>의 <code>state</code>인 <code>hideModal</code>함수 –&gt; <code>WriteModalView</code>의 <code>prop</code>인 <code>hideModal</code>함수</li>
</ul>
<p>자식인 <code>WriteModalView</code>에서 <code>modalVisible</code>을 변경할 수 있게 하려고<br><code>hideModal</code>이란 함수를 만들어서 <code>WriteModalView</code>의 <code>prop</code>으로 전달하였다.<br>자식인 <code>WriteModalView</code>에서 <code>hideModal</code>함수를 호출하게 되면<br>부모인 <code>WriteButton</code>의 <code>state</code>인 <code>modalVisible</code>이 변경될 것이고,<br>이것이 다시 자식인 <code>WriteModalView</code>의 <code>prop</code>인 <code>modalVisible</code>을 변경시킬 것이다.<br><em>구조에 대한 이해가 어려울 수 있다</em></p>
<h2 id="WriteModalView"><a href="#WriteModalView" class="headerlink" title="WriteModalView"></a>WriteModalView</h2><p>글쓰기 Modal View의 구현 내용은 다음과 같다.<br>{% gist 17044097f89338ca814d4b6ff01e24e3 WriteModalView.js %}</p>
<p>각 라인별로 역할을 살펴보자.</p>
<ol>
<li>1~3 라인: 사용할 컴포넌트 들을 import 하는 부분이다.</li>
<li>4 라인: db 연동이 필요하기 때문에 realm도 import 한다.</li>
<li>6~14라인: 날짜를 다루는데 사용할 함수를 구현해 두었다.</li>
<li>30~62라인: <code>render()</code>함수 구현 부분이다. 눈여겨 볼 부분은 <code>Modal</code> 컴포넌트를 설정한 33~37라인과 사용자가 입력한 내용을 <code>contextText</code>라는 <code>state</code>로 저장하는 46라인이다. 글쓰기와 글쓰기 취소는 두개 버튼을 두어서 구현하였다. 글쓰기를 누르면 <code>write</code>함수를 호출하고, 안쓰기를 누르면 <code>modalVisible</code>을 변경하여 화면을 사라지게 만들었다.</li>
<li>17~29라인: 핵심 기능인 글쓰기 <code>write</code> 함수이다. 현재 날짜와, 사용자가 입력한 내용(<code>contentText</code>)을 가져와서, realm에 등록한다.</li>
</ol>
<h2 id="확인"><a href="#확인" class="headerlink" title="확인"></a>확인</h2><p>글쓰기 버튼을 누르면 아래 화면이 나온다<br><strong>이미지 없음</strong> <!--![check_01](last_01.png)--></p>
<p>막 써보자<br><strong>이미지 없음</strong> <!--![check_02](last_02.png)--></p>
<p>R키를 두번 눌러서 새로고침 하면 등록한 내용이 잘 표시되는 것을 볼 수 있다.<br><strong>이미지 없음</strong> <!--![check_03](last_03.png)--></p>
<hr>
<h1 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h1><p>여러 일이 겹치면서 아주아주 더디게 진행하던 <code>react native</code> 첫번째 앱은 글쓰기 구현을 마지막으로 중단한다.<br>기능을 추가하자면 끝도 없이 많지만 <code>realm</code>을 연동한 대강의 구조를 구현했다는데에 의의를 둔다.<br><code>react native</code>에 <code>Map</code>, <code>AR</code>, <code>firebase</code> 등등 다른 모듈을 사용한 새 앱을 또 만들어 볼 것이다.</p>
<p>그럼 오늘은 이만!</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/05/07/hi-there/" class="prev">PREV</a><a href="/2017/02/01/react-native-diary-part-four/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'dumok';
var disqus_identifier = '2017/03/20/react-native-diary-part-five/';
var disqus_title = 'React Native 일기장 앱 개발 (End) - 글쓰기 기능';
var disqus_url = 'http://yoursite.com/2017/03/20/react-native-diary-part-five/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//dumok.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 <a href="http://yoursite.com">Dumok Nam</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/MikeCoder/hexo-theme-gandalfr" target="_blank">hexo-theme-gandalfr</a>.</p></div></footer></div><script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" crossorigin="anonymous"></script><script src="//cdn.bootcss.com/jquery/3.1.1/jquery.js" crossorigin="anonymous"></script><script>$(document).ready(function() { $('pre').each(function(i, block) { hljs.highlightBlock(block); }); });</script></body></html>